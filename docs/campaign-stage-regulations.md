# キャンペーンステージ レギュレーション一覧

<!-- ドキュメント冒頭で目的と更新方針を共有し、参照者の期待値をそろえる -->
MonoKnight のキャンペーンモードに収録されている各ステージのレギュレーション（盤面・山札・ペナルティ・ギミック・スター条件）を
最新実装に基づいて整理する。実装の一次情報は `Game/CampaignStage.swift` および `Game/GameMode.swift` の `Regulation` 定義であるため、
ステージを追加・更新する際は必ずコードと本書を同時に改訂する。<!-- ドキュメント先行で乖離が生じないよう明記 -->

## 1. サマリー

<!-- チームが全体像を俯瞰できるよう一覧表を用意する -->
| ステージ | 盤面 / スポーン | 山札プリセット | 特殊タイル / カード | セカンダリ条件 | スコア上限 | ペナルティ設定 | アンロック条件 |
|----------|-----------------|----------------|----------------------|----------------|------------|-----------------|----------------|
| 1-1 王将訓練 | 3×3 / 中央固定 | `kingOnly` | なし | 60 秒以内クリア | 300 未満 | +2 / +2 / +1 / +1 | 初期解放 |
| 1-2 ナイト初見 | 3×3 / 中央固定 | `kingPlusKnightOnly` | なし | ペナルティ合計 3 以下 | 300 未満 | +2 / +2 / +1 / 0 | 1-1 クリア |
| 1-3 4×4基礎 | 4×4 / 中央固定 | `kingAndKnightBasic` | なし | 60 秒以内 | 400 未満 | +3 / +1 / +1 / 0 | 1-2 クリア |
| 1-4 4×4応用 | 4×4 / 任意スポーン | `kingAndKnightBasic` | なし | ペナルティ合計 5 以下 | 400 未満 | +3 / +1 / +1 / 0 | 1-3 クリア |
| 1-5 4×4持久 | 4×4 / 中央固定 | `standardLight` | なし | 30 手以内 | 400 未満 | +3 / +2 / +1 / 0 | 1-4 クリア |
| 1-6 4×4戦略 | 4×4 / 任意スポーン | `kingAndKnightBasic` | なし | ペナルティ合計 3 以下 | 400 未満 | +3 / +2 / +1 / 0 | 1-5 クリア |
| 1-7 5×5導入 | 5×5 / 中央固定 | `standardLight` | なし | 40 手以内 | 460 未満 | +3 / +2 / +1 / 0 | 1-6 クリア |
| 1-8 総合演習 | 5×5 / 任意スポーン | `standardLight` | なし | 35 手以内 | 440 未満 | +3 / +2 / +1 / 0 | 1-7 クリア |
| 2-1 重踏チュートリアル | 4×4 / 中央固定 | `kingAndKnightBasic` | 二度踏み ×2（(0,1)・(2,3)） | ペナルティ合計 5 以下 | 450 以下 | +3 / +2 / +1 / 0 | 1章スター合計 16 以上 |
| 3-1 縦横選択訓練 | 5×5 / 中央固定 | `standardWithOrthogonalChoices` | なし | ペナルティ合計 2 以下 | 600 以下 | +3 / +2 / +1 / 0 | 2-1 クリア |
| 3-2 斜め選択応用 | 5×5 / 中央固定 | `standardWithDiagonalChoices` | なし | 32 手以内 | 580 以下 | +3 / +2 / +1 / 0 | 3-1 クリア |
| 3-3 桂馬選択攻略 | 5×5 / 中央固定 | `standardWithKnightChoices` | なし | 30 手以内 | 560 以下 | +3 / +2 / +1 / 0 | 3-2 クリア |
| 3-4 総合選択演習 | 5×5 / 中央固定 | `standardWithAllChoices` | なし | 28 手以内 | 540 未満 | +3 / +2 / +1 / 0 | 3-3 クリア |
| 4-1 反転制御訓練 | 5×5 / 中央固定 | `standard` | トグル ×2 | 30 手以内 | 520 以下 | +3 / +2 / +1 / 0 | 3-4 クリア |
| 5-1 障害物突破演習 | 5×5 / 中央固定 | `standardWithAllChoices` | 障害物 ×2 | 27 手以内 | 500 未満 | +3 / +2 / +1 / 0 | 4-1 クリア |
<!-- 章6〜8の代表ステージを抜粋し、上位章の難度感を俯瞰しやすくする -->
| 6-1 転送導入演習 | 5×5 / 中央固定 | `standardWithAllChoices` | ワープ {(0,0)↔(4,4)} | 40 手以内 | 520 以下 | +3 / +2 / +1 / 0 | 5-8 最終試験クリア |
| 6-5 任意転送応用 | 5×5 / 任意スポーン | `standardWithAllChoices` | ワープ {(0,0)↔(2,2),(1,4)↔(4,1),(0,4)↔(4,0)} | 36 手以内 | 480 以下 | +3 / +2 / +1 / 0 | 6-4 クリア |
| 7-1 拡張移動導入 | 5×5 / 中央固定 | `extendedWithMultiStepMoves` | 複数マス移動カード常駐 | 38 手以内 | 440 以下 | +3 / +2 / +1 / 0 | 6-8 転送最終演習クリア |
| 7-5 シャッフル導入 | 5×5 / 任意スポーン | `extendedWithMultiStepMoves` | シャッフル {(2,2)} | 36 手以内 | 420 以下 | +3 / +2 / +1 / 0 | 7-4 クリア |
| 8-1 ワープカード訓練 | 5×5 / 中央固定 | `standardWithWarpCards` | ワープカード供給 | 38 手以内 | 400 以下 | +3 / +2 / +1 / 0 | 7-8 拡張行動総決算クリア |
| 8-5 任意転移演習 | 5×5 / 任意スポーン | `standardWithWarpCards` | ワープカード＋二度踏み {(2,2):2} | ペナルティ合計 2 以下 | 380 以下 | +3 / +2 / +1 / 0 | 8-4 反転連動演習クリア |

> **注記:** ペナルティ欄は `deadlock / manualRedraw / manualDiscard / revisit` の順で手数加算量を記載。<!-- 記法を明示 -->
> **補足:** セカンダリ条件に記載する数値は、手数換算済みのペナルティ合計値（=累計加算量）を表す。<!-- 単位表記を省いた理由を説明 -->
> **備考:** 章6〜8はワープ／複数マス移動／ワープカードを扱う高難度章である。<!-- 実装済み上位章の特徴を簡潔に共有し、参照者の理解を助ける -->

## 2. ステージ設定共通仕様

<!-- ステージ追加時に確認すべきパラメータ群を整理する -->
- **定義ファイル**: `CampaignLibrary.buildChapters()` にステージを追加し、`CampaignStage` 初期化時に `GameMode.Regulation` を渡す。
- **盤面サイズ (`boardSize`)**: 現状は 3×3〜5×5。サイズ拡張時は手数目標とスコア上限の再調整が必須。
- **スポーン (`spawnRule`)**: 既存ステージはすべて `fixed(BoardGeometry.defaultSpawnPoint)`。ランダム/選択スポーン導入時は UI と連携する。
- **手札・先読み (`handSize` / `nextPreviewCount`)**: 全ステージで手札 5 種類・先読み 3 枚。同種カードスタックは常時有効。
- **山札 (`deckPreset`)**: `GameDeckPreset` 列挙を指定。プリセットに存在しないカードを直接追加しないこと。<!-- Deck テスト失敗を防止 -->
- **ペナルティ (`GameMode.PenaltySettings`)**: `deadlock`・`manualRedraw`・`manualDiscard`・`revisit` の 4 種を整数手数で指定。
- **追加踏破マス (`additionalVisitRequirements`)**: `GridPoint: Int` の辞書で管理。値は必要踏破回数。<!-- 二度踏みマスの再現に利用 -->
- **トグルマス (`toggleTilePoints`)**: `Set<GridPoint>`。同座標に追加踏破設定がある場合、トグルが優先され踏破状態が反転。<!-- 優先順位を明確化 -->
- **障害物 (`impassableTilePoints`)**: `Set<GridPoint>`。カード候補から除外され、移動不可。
- **スター条件**: `secondaryObjective`（手数・時間・ペナルティ・再訪禁止）と `scoreTarget`（閾値 + 比較方式）の二段構成。UI テキストは `CampaignStage` が生成。
- **アンロック条件**: `CampaignStageUnlockRequirement` を利用。総スター数ではなくステージクリアが条件のケースに注意。

## 3. 山札プリセット一覧

<!-- 実装済みプリセットの構成と抽選特徴をまとめる -->
| プリセット ID | 構成内容 | 抽選重みの特徴 | 主な用途 |
|----------------|-----------|----------------|-----------|
| `kingOnly` | キング型 8 種のみ | 全カードを均等重み (1) で抽選 | 3×3 初学者訓練 (1-1)。 |
| `standard` | `MoveCard.standardSet` 24 種 | 全カードを均等重み (1) で抽選 | 4×4〜5×5 の基礎ステージ。 |
| `standardWithOrthogonalChoices` | 標準 + 上下左右選択キング 2 種 | 選択カードのみ重み 2 / その他は 1 | 3-1 の選択カード導入。 |
| `standardWithDiagonalChoices` | 標準 + 斜め選択キング 4 種 | 選択カードのみ重み 2 / その他は 1 | 3-2 の角操作練習。 |
| `standardWithKnightChoices` | 標準 + 桂馬選択 4 種 | 選択カードのみ重み 2 / その他は 1 | 3-3 のジャンプ練習。 |
| `standardWithAllChoices` | 標準 + 全選択カード 10 種 | 全カードを均等重み (1) で抽選 | 3-4・5-1 の総合演習。 |

> **補足:** 章 3 の導入をスムーズにするため、各種選択カードは `Deck.Configuration.WeightProfile` の `overrides` で重み 2 に上書きしている。その他カードは従来通り重み 1 を維持する。<!-- コード変更ポイントと調整理由を明記 -->

## 4. ペナルティ設定一覧

<!-- ステージ別に採用しているペナルティ値を比較し、バランス確認を容易にする -->
| 適用範囲 | deadlock | manualRedraw | manualDiscard | revisit | 備考 |
|-----------|----------|--------------|---------------|---------|------|
| 章 1-1 | +2 | +2 | +1 | +1 | 王将のみの超序盤設定。 |
| 章 1-2 | +2 | +2 | +1 | 0 | キング＋桂馬限定でペナルティ軽減。 |
| 章 1-3 / 1-4 / 2-1 | +3 | +2 | +1 | 0 | 4×4 基礎〜応用および二度踏み練習。 |
| 章 1-5〜1-8 | +3 | +2 | +1 | 0 | 任意スポーン含む持久・戦略ステージ。 |
| 章 3-1〜5-1 | +3 | +2 | +1 | 0 | スタンダード準拠。 |

## 5. 実装済みギミック

<!-- ギミック挙動を定義し、ステージ設計時の誤用を防ぐ -->
- **二度踏みマス**: `(0,1)`・`(2,3)`（内部座標）。`additionalVisitRequirements` に値 `2` を設定。1 回目では未踏扱いのまま。
- **トグルマス**: `(0,1)`・`(2,3)`（内部座標）。`toggleTilePoints` に登録し、踏むたびに踏破⇔未踏を反転。
- **障害物マス**: `(0,1)`・`(2,3)`（内部座標）。`impassableTilePoints` に登録し、移動候補から除外。
- **ヒントホットスポット / 手札補充ブースト**: 実装済みだがキャンペーンでは未使用。将来採用時は本書へ追記する。<!-- 今後の運用余地を示す -->

## 6. 章別詳細

<!-- 各章のテーマとステージ仕様を丁寧に整理し、議論時の参照性を高める -->
# 第1章「基礎訓練」 改訂版レギュレーション

* **テーマ**: 小盤面から始め、移動カードと盤面拡張に慣れる。
* **スポーン**: 基本は中央固定、一部ステージで「任意位置スポーン」を導入。
* **ペナルティ**: 章全体で軽め（deadlock +2〜+3 / redraw +1〜+2 / discard +1 / revisit 0〜+1）。

---

## ステージ一覧

| ステージ      | 盤面 / スポーン          | 山札プリセット                        | 特殊タイル | セカンダリ条件     | スコア上限  | ペナルティ設定           | アンロック条件 |
| --------- | ------------------ | ------------------------------ | ----- | ----------- | ------ | ----------------- | ------- |
| 1-1 王将訓練  | 3×3 / 中央固定         | `kingOnly`                     | なし    | 60 秒以内     | 300 未満 | +2 / +2 / +1 / +1 | 初期解放    |
| 1-2 ナイト初見 | 3×3 / 中央固定         | `kingPlusKnightOnly`             | なし    | ペナルティ合計 3 以下 | 300 未満 | +2 / +2 / +1 / 0  | 1-1 クリア |
| 1-3 4×4基礎 | 4×4 / 中央固定         | `kingAndKnightBasic`（新）        | なし    | 60 秒以内      | 400 未満 | +3 / +1 / +1 / 0  | 1-2 クリア |
| 1-4 4×4応用 | 4×4 / **任意位置スポーン** | `kingAndKnightBasic`           | なし    | ペナルティ合計 5 以下 | 400 未満 | +3 / +1 / +1 / 0  | 1-3 クリア |
| 1-5 4×4持久 | 4×4 / 中央固定         | `standardLight`（標準から長距離カードの重みを軽く設定） | なし    | 30 手以内      | 400 未満 | +3 / +2 / +1 / 0  | 1-4 クリア |
| 1-6 4×4戦略 | 4×4 / **任意位置スポーン** | `kingAndKnightBasic`           | なし    | ペナルティ合計 3 以下 | 400 未満 | +3 / +2 / +1 / 0  | 1-5 クリア |
| 1-7 5×5導入 | 5×5 / 中央固定         | `standardLight`                | なし    | 40 手以内      | 460 未満 | +3 / +2 / +1 / 0  | 1-6 クリア |
| 1-8 総合演習  | 5×5 / **任意位置スポーン** | `standardLight`                | なし    | 35 手以内      | 440 未満 | +3 / +2 / +1 / 0  | 1-7 クリア |

---

## 補足

* **任意スポーン導入**: 1-4, 1-6, 1-8 に採用。運要素を排しつつ戦略性を強化。
* **山札プリセット**

  * `kingPlusKnightOnly`: 1-2 限定、キング4種＋ナイト4種など軽量構成。
  * `kingAndKnightBasic`: 1-3 以降の標準。キング8種＋ナイト8種のみ。
  * `standardLight`: `standard` から直線2・斜め2のカード重みを 1 に下げた構成。
* **ペナルティ**: 全体的に軽め (+2〜+3) に統一。2章以降で標準準拠(+3 / +2 / +1 / 0)へ移行させる。


# 第2章「応用特訓（重踏）」レギュレーション

## 概要
- 多重踏破マス（`additionalVisitRequirements`）の操作を習得する章。指定回数を満たすまでマスが踏破済みにならない点を強調する。
- 基本盤面は 5×5 だが、導入の 2-1 のみ 4×4。スポーンは 2-1 だけ中央固定で、以降は任意位置スポーン。
- デッキは `kingAndKnightBasic` を共通採用。選択カードは未解禁。
- ペナルティは全ステージで `deadlock +3 / manualRedraw +2 / manualDiscard +1 / revisit 0` に統一。

## 共通設定
| 項目 | 値 |
|------|----|
| `boardSize` | 2-1 は 4、その他は 5 |
| `spawnRule` | 2-1: `.fixed(BoardGeometry.defaultSpawnPoint)` / 2-2〜2-8: `.chooseAnyAfterPreview` |
| `deckPreset` | `.kingAndKnightBasic` |
| `penaltySettings` | `.init(deadlock: 3, manualRedraw: 2, manualDiscard: 1, revisit: 0)` |

## ステージ一覧
| ステージ | 盤面 / スポーン | 踏破要求マス (内部座標) | セカンダリ条件 | スコア上限 | ペナルティ設定 | アンロック条件 |
|----------|-----------------|------------------------|----------------|------------|-----------------|----------------|
| 2-1 重踏チュートリアル | 4×4 / 中央固定 | {(0,1):2, (2,3):2} | ペナルティ合計 5 以下 | 450 以下 | +3 / +2 / +1 / 0 | 1章スター合計 16 以上 |
| 2-2 基礎演習 | 5×5 / 任意 | {(1,1):2, (3,3):2} | 45 手以内 | 450 以下 | +3 / +2 / +1 / 0 | 2-1 クリア |
| 2-3 三重踏み入門 | 5×5 / 任意 | {(2,2):3} | 40 手以内 | 450 以下 | +3 / +2 / +1 / 0 | 2-2 クリア |
| 2-4 複数三重踏み | 5×5 / 任意 | {(1,1):3, (3,3):3} | ペナルティ合計 3 以下 | 580 以下 | +3 / +2 / +1 / 0 | 2-3 クリア |
| 2-5 中央集中 | 5×5 / 任意 | {(2,2):4} | 40 手以内 | 570 以下 | +3 / +2 / +1 / 0 | 2-4 クリア |
| 2-6 四重踏み分散 | 5×5 / 任意 | {(1,1):4, (3,3):4} | 130 秒以内 | 560 以下 | +3 / +2 / +1 / 0 | 2-5 クリア |
| 2-7 複合課題 | 5×5 / 任意 | {(1,1):2, (2,2):3, (3,3):4} | 38 手以内 | 550 以下 | +3 / +2 / +1 / 0 | 2-6 クリア |
| 2-8 総合演習 | 5×5 / 任意 | {(1,1):3, (3,1):3, (1,3):3, (3,3):3} | 40 手以内 | 540 以下 | +3 / +2 / +1 / 0 | 2-7 クリア |

## QA チェック観点
- 任意スポーンステージで致命的な詰みが発生しないかを 20 回以上の試行で確認する。特に 2-5・2-6 は四重踏みの要求回数が多いためシーケンス依存度が高い。
- 多重踏破マスの残り回数表示が 0〜3 の遷移で崩れないかを確認する。
- 想定攻略ルートのスコア中央値と上限値の差分を毎章ごとにレビューし、過度に厳しい閾値になっていないかを調整する。

# 第3章「多方向訓練（選択カード＋複数踏破）」レギュレーション

## 概要
- 選択式カードを段階導入しつつ、2章で学んだ複数踏破マスを後半に再登場させる構成。
- 3-1 のみ 4×4、以降は 5×5。スポーンは基本的に中央固定で、任意スポーンは 3-5 と 3-7 に限定する。
- 山札プリセットは章内で段階的に拡張（縦横選択 → 斜め → 桂馬 → 全選択）。
- ペナルティは `deadlock +3 / manualRedraw +2 / manualDiscard +1 / revisit 0` が基準。3-1 と 3-8 はペナルティ合計 2 以下の条件で難度を調整する。

## 共通設定
| 項目 | 値 |
|------|----|
| `boardSize` | 3-1: 4 / 3-2〜3-8: 5 |
| `spawnRule` | 基本 `.fixed(BoardGeometry.defaultSpawnPoint)`（任意スポーンは 3-5・3-7 のみ） |
| `penaltySettings` | `.init(deadlock: 3, manualRedraw: 2, manualDiscard: 1, revisit: 0)` |

## ステージ一覧
| ステージ | 盤面 / スポーン | 山札プリセット | 特殊タイル | セカンダリ条件 | スコア上限 | ペナルティ設定 | アンロック条件 |
|----------|-----------------|----------------|------------|----------------|------------|-----------------|----------------|
| 3-1 縦横選択チュートリアル | 4×4 / 中央固定 | `standardWithOrthogonalChoices` | なし | ペナルティ合計 2 以下 | 600 以下 | +3 / +2 / +1 / 0 | 2-8 クリア |
| 3-2 縦横基礎 | 5×5 / 中央固定 | `standardWithOrthogonalChoices` | なし | 40 手以内 | 590 以下 | +3 / +2 / +1 / 0 | 3-1 クリア |
| 3-3 斜め選択入門 | 5×5 / 中央固定 | `standardWithDiagonalChoices` | なし | ペナルティ合計 2 以下 | 580 以下 | +3 / +2 / +1 / 0 | 3-2 クリア |
| 3-4 桂馬選択入門 | 5×5 / 中央固定 | `standardWithKnightChoices` | なし | 38 手以内 | 570 以下 | +3 / +2 / +1 / 0 | 3-3 クリア |
| 3-5 選択＋二度踏み | 5×5 / 任意 | `standardWithOrthogonalChoices` | 二度踏み {(1,1):2, (3,3):2} | 36 手以内 | 560 以下 | +3 / +2 / +1 / 0 | 3-4 クリア |
| 3-6 全選択＋三重踏み | 5×5 / 中央固定 | `standardWithAllChoices` | 三重踏み {(2,2):3, (3,1):3} | ペナルティ合計 1 以下 | 550 以下 | +3 / +2 / +1 / 0 | 3-5 クリア |
| 3-7 全選択＋四重踏み | 5×5 / 任意 | `standardWithAllChoices` | 四重踏み {(1,1):4, (3,3):4} | 36 手以内 | 540 以下 | +3 / +2 / +1 / 0 | 3-6 クリア |
| 3-8 総合演習 | 5×5 / 中央固定 | `standardWithAllChoices` | 2/3/4 回混合 {(1,1):2, (2,2):3, (3,3):4} | ペナルティ合計 2 以下＆36手以内 | 530 以下 | +3 / +2 / +1 / 0 | 3-7 クリア |


## QA チェック観点
- 選択カードのカード説明と実際の挙動が一致しているかを章内で確認する（縦横・斜め・桂馬・総合）。
- 複数踏破とトグル未導入ステージの UI 表示が混在していないかを確認し、章のテーマを明確に保つ。
- ペナルティ制限ステージ（3-1・3-8）は `deadlock` ルートでも達成条件が破綻しないかを重点的に QA する。

# 第4章「反転応用（トグルマス＋複数踏破）」レギュレーション

## 概要
- トグルマスの制御を中心に、複数踏破マスを段階的に組み合わせる章。全ステージで盤面は 5×5。
- スポーンは前半が中央固定、4-5〜4-7 のみ任意スポーン。最終ステージ 4-8 は再び中央固定で締める。
- 山札は基礎で `standardLight`、複合ギミック導入後は `standardWithAllChoices` を使用する。
- ペナルティ設定は基本 `deadlock +3 / manualRedraw +2 / manualDiscard +1 / revisit 0`。4-7・4-8 はペナルティ合計 2 以下の条件で緊張感を維持する。

## 共通設定
| 項目 | 値 |
|------|----|
| `boardSize` | 常に 5 |
| `spawnRule` | 4-1〜4-4: `.fixed(BoardGeometry.defaultSpawnPoint)` / 4-5〜4-7: `.chooseAnyAfterPreview` / 4-8: `.fixed` |
| `penaltySettings` | `.init(deadlock: 3, manualRedraw: 2, manualDiscard: 1, revisit: 0)` |

## ステージ一覧
| ステージ | 盤面 / スポーン | 山札プリセット | 特殊タイル | セカンダリ条件 | スコア上限 | ペナルティ設定 | アンロック条件 |
|----------|-----------------|----------------|------------|----------------|------------|-----------------|----------------|
| 4-1 トグル基礎 | 5×5 / 中央固定 | `standardLight` | トグル {(1,1), (3,3)} | 30 手以内 | 520 以下 | +3 / +2 / +1 / 0 | 3-8 クリア |
| 4-2 トグル応用 | 5×5 / 中央固定 | `standardLight` | トグル {(2,2), (1,3), (3,1)} | ペナルティ合計 2 以下 | 510 以下 | +3 / +2 / +1 / 0 | 4-1 クリア |
| 4-3 トグル＋二度踏み | 5×5 / 中央固定 | `standardLight` | トグル {(1,1), (3,3)} ＋ 二度踏み {(0,2):2, (4,2):2} | 40 手以内 | 500 以下 | +3 / +2 / +1 / 0 | 4-2 クリア |
| 4-4 トグル＋三重踏み | 5×5 / 中央固定 | `standardWithAllChoices` | トグル {(1,1), (3,3)} ＋ 三重踏み {(2,2):3} | ペナルティ合計 1 以下 | 490 以下 | +3 / +2 / +1 / 0 | 4-3 クリア |
| 4-5 トグル集中制御 | 5×5 / 任意 | `standardWithAllChoices` | トグル {(0,0), (4,0), (0,4), (4,4)} | 38 手以内 | 480 以下 | +3 / +2 / +1 / 0 | 4-4 クリア |
| 4-6 トグル＋四重踏み | 5×5 / 任意 | `standardWithAllChoices` | トグル {(1,1), (3,3)} ＋ 四重踏み {(2,2):4} | 36 手以内 | 470 以下 | +3 / +2 / +1 / 0 | 4-5 クリア |
| 4-7 トグル＋複合踏破 | 5×5 / 任意 | `standardWithAllChoices` | トグル {(1,1), (3,3)} ＋ 二度踏み {(0,2):2, (4,2):2} ＋ 三重踏み {(2,2):3} | ペナルティ合計 2 以下 | 460 以下 | +3 / +2 / +1 / 0 | 4-6 クリア |
| 4-8 総合演習 | 5×5 / 中央固定 | `standardWithAllChoices` | トグル {(1,1), (3,3), (2,4)} ＋ 2/3/4 回混合 {(0,0):2, (4,0):3, (2,2):4} | 34 手以内＆ペナルティ合計 2 以下 | 450 以下 | +3 / +2 / +1 / 0 | 4-7 クリア |

## QA チェック観点
- トグルマスの初期状態とトグル後の踏破フラグが意図通りに更新されるかを全ステージで確認する。
- 任意スポーン導入後は開始位置によってトグル順序が破綻しないかを複数パターンで検証する。
- 複数踏破とトグルを同時に含むステージでは、UI の視覚表現が重なって見づらくならないかを評価する。

# 第5章「障害物攻略（障害物＋複数踏破＋トグル）」レギュレーション

## 概要
- 障害物マスを追加し、トグル・複数踏破ギミックと組み合わせた総合章。すべて 5×5 盤で構成する。
- スポーンは 5-4・5-6・5-7 のみ任意スポーン、それ以外は中央固定。
- 山札は章全体で `standardWithAllChoices` を使用し、全種の移動カードを前提とした攻略難度に調整する。
- ペナルティは `deadlock +3 / manualRedraw +2 / manualDiscard +1 / revisit 0` が基準。終盤の 5-7・5-8 ではペナルティ合計 2 以下を条件として課す。

## 共通設定
| 項目 | 値 |
|------|----|
| `boardSize` | 常に 5 |
| `spawnRule` | 5-1・5-3・5-5: `.fixed(BoardGeometry.defaultSpawnPoint)` / 5-2・5-4・5-6〜5-8: `.chooseAnyAfterPreview` |
| `deckPreset` | `.standardWithAllChoices` |
| `penaltySettings` | `.init(deadlock: 3, manualRedraw: 2, manualDiscard: 1, revisit: 0)` |

## ステージ一覧
| ステージ | 盤面 / スポーン | 特殊タイル | セカンダリ条件 | スコア上限 | ペナルティ設定 | アンロック条件 |
|----------|-----------------|------------|----------------|------------|-----------------|----------------|
| 5-1 障害物基礎 | 5×5 / 中央固定 | 障害物 {(1,1), (3,3)} | 30 手以内 | 500 以下 | +3 / +2 / +1 / 0 | 4-8 クリア |
| 5-2 障害物応用 | 5×5 / 任意スポーン | 障害物 {(1,1), (3,3), (2,2)} | ペナルティ合計 2 以下 | 490 以下 | +3 / +2 / +1 / 0 | 5-1 クリア |
| 5-3 障害物＋二度踏み | 5×5 / 中央固定 | 障害物 {(0,1), (4,3)} ＋ 二度踏み {(1,3):2, (3,1):2} | 40 手以内 | 480 以下 | +3 / +2 / +1 / 0 | 5-2 クリア |
| 5-4 障害物＋三重踏み | 5×5 / 任意 | 障害物 {(0,2), (4,2)} ＋ 三重踏み {(2,2):3} | ペナルティ合計 1 以下 | 470 以下 | +3 / +2 / +1 / 0 | 5-3 クリア |
| 5-5 障害物＋トグル | 5×5 / 中央固定 | 障害物 {(1,1), (3,3)} ＋ トグル {(2,1), (2,3)} | 38 手以内 | 460 以下 | +3 / +2 / +1 / 0 | 5-4 クリア |
| 5-6 複合 (四重踏み含む) | 5×5 / 任意 | 障害物 {(1,1), (3,3)} ＋ 四重踏み {(2,2):4} ＋ トグル {(0,4)} | 36 手以内 | 450 以下 | +3 / +2 / +1 / 0 | 5-5 クリア |
| 5-7 複合 (多要素) | 5×5 / 任意 | 障害物 {(1,1), (3,3), (2,4)} ＋ 二度踏み {(0,0):2} ＋ 三重踏み {(4,4):3} ＋ トグル {(2,2)} | ペナルティ合計 2 以下 | 440 以下 | +3 / +2 / +1 / 0 | 5-6 クリア |
| 5-8 最終試験 | 5×5 / 任意スポーン | 障害物 {(1,1), (3,3), (2,2)} ＋ 2/3/4 回混合 {(0,4):2, (4,0):3, (2,4):4} ＋ トグル {(1,3), (3,1)} | 34 手以内＆ペナルティ合計 2 以下 | 430 以下 | +3 / +2 / +1 / 0 | 5-7 クリア |

> **補足:** 5-2 と 5-8 は中央を含む障害物配置のため、任意スポーンへ切り替えて開幕から移動不能になる事故を防いでいる。<!-- コード上の `impassableTilePoints` と整合させる背景を明示 -->

## QA チェック観点
- 障害物マスの座標が山札から引いたカード移動候補に反映されているかを全カードで確認する。
- 障害物とトグルが隣接するケースでは、踏破状態の更新と移動禁止が衝突しないかをテストする。
- ペナルティ制限ステージでは、任意スポーンによる不利配置が発生しても達成可能かを確認する。

# 第6章「転送戦術（ワープマス）」レギュレーション

<!-- 章6はワープマスによる位置転送を主題にした高難度帯。ここから新ギミックが本格導入されるため、導入意図を明文化しておく -->

## 概要
- ワープマスのペア転送を用いて踏破ルートを再設計する章。<!-- ギミックの狙いを冒頭で共有 -->
- 前半（6-1〜6-4）は中央固定スポーンで安全に転送挙動を学び、後半（6-5〜6-7）は任意スポーンで初期位置リスクへの対応力を試す。<!-- スポーン方針を記載 -->
- 山札は `standardWithAllChoices` を共通採用し、既存カードでワープ連動ルートを組み立てる。<!-- デッキの統一方針を説明 -->
- ペナルティ設定は全ステージ共通で `+3 / +2 / +1 / 0`。セカンダリ条件で緊張感を調整する。<!-- ペナルティを明示 -->

## 共通設定
<!-- 依頼で指定された設定値をそのまま転記し、コメントで意図を補足 -->
| 項目 | 値 |
|------|----|
| `boardSize` | 5（5×5 固定でワープ導線を設計） |
| `spawnRule` | 6-1〜6-4: `.fixed(BoardGeometry.defaultSpawnPoint)` / 6-5〜6-7: `.chooseAnyAfterPreview` / 6-8: `.fixed`（任意スポーンで詰み検証→締めは固定） |
| `deckPreset` | `.standardWithAllChoices`（既存カード構成にワープマスを追加する想定） |
| `penaltySettings` | `.init(deadlock: 3, manualRedraw: 2, manualDiscard: 1, revisit: 0)`（既存標準値を据え置き） |

## ステージ一覧
<!-- ステージ個別のギミックと条件を詳細化。特にワープ座標は内部座標で記載し、QA 時の参照に活用する -->
| ステージ | 盤面 / スポーン | 山札プリセット | 特殊タイル | セカンダリ条件 | スコア上限 | ペナルティ設定 | アンロック条件 |
|----------|-----------------|----------------|------------|----------------|------------|-----------------|----------------|
| 6-1 転送導入演習 | 5×5 / 中央固定 | `standardWithAllChoices` | ワープ {(0,0)↔(4,4)}（踏破同期テスト用） | 40 手以内 | 520 以下 | +3 / +2 / +1 / 0 | 5-8 最終試験クリア |
| 6-2 二重転送訓練 | 5×5 / 中央固定 | `standardWithAllChoices` | ワープ {(0,4)↔(4,0), (1,1)↔(3,3)} | ペナルティ合計 2 以下 | 510 以下 | +3 / +2 / +1 / 0 | 6-1 クリア |
| 6-3 転送＋反転整備 | 5×5 / 中央固定 | `standardWithAllChoices` | ワープ {(1,1)↔(3,3)}＋トグル {(2,2)} | 38 手以内 | 500 以下 | +3 / +2 / +1 / 0 | 6-2 クリア |
| 6-4 転送＋多重踏破 | 5×5 / 中央固定 | `standardWithAllChoices` | ワープ {(0,4)↔(4,0)}＋二度踏み {(2,2):2} | ペナルティ合計 1 以下 | 490 以下 | +3 / +2 / +1 / 0 | 6-3 クリア |
| 6-5 任意転送応用 | 5×5 / 任意スポーン | `standardWithAllChoices` | ワープ {(0,0)↔(2,2), (1,4)↔(4,1), (0,4)↔(4,0)} | 36 手以内 | 480 以下 | +3 / +2 / +1 / 0 | 6-4 クリア |
| 6-6 転送＋障害回避 | 5×5 / 任意スポーン | `standardWithAllChoices` | ワープ {(1,1)↔(3,3)}＋障害物 {(2,2)} | ペナルティ合計 2 以下 | 470 以下 | +3 / +2 / +1 / 0 | 6-5 クリア |
| 6-7 転送統合課題 | 5×5 / 任意スポーン | `standardWithAllChoices` | ワープ {(0,0)↔(4,4)}＋トグル {(1,1),(3,3)}＋三重踏み {(2,2):3} | 34 手以内 | 460 以下 | +3 / +2 / +1 / 0 | 6-6 クリア |
| 6-8 転送最終演習 | 5×5 / 中央固定 | `standardWithAllChoices` | ワープ {(0,4)↔(4,0),(1,3)↔(3,1)}＋障害物 {(0,0)}＋トグル {(2,2)} | ペナルティ合計 2 以下＆32 手以内 | 450 以下 | +3 / +2 / +1 / 0 | 6-7 クリア |

## 実装デザイン仕様
<!-- ビジュアルとアニメーションのみを整理し、演出共有コストを下げる -->
- **ワープマスのビジュアル**: モノクロ基調を守りつつ、リング状の白銀ラインと中心の淡いシアン発光で転送地点を強調する。<!-- 盤面上での視認性を担保 -->
- **ワープ発動アニメーション**: 駒接触時にリングが 0.2 秒で収縮 → 0.1 秒で拡張し、対応ペアのマスへ白いトレイルを伸ばして瞬間移動させる。<!-- 遷移の瞬間を視覚化 -->
- **サウンド方針**: 今回は新規 SE を導入せず、無音で演出する。視覚情報のみで挙動を伝える。<!-- 指示通り SE を追加しないことを明記 -->

## QA チェック観点
<!-- QA で重視すべきポイントを洗い出し、実装後の検証効率を高める -->
- ワープペア踏破時に両マスの踏破フラグが同時更新されるか（特に 6-1・6-2）。<!-- 踏破同期の確認 -->
- 任意スポーン導入ステージ（6-5〜6-7）で初手ワープが詰みにならないか 20 回以上検証する。<!-- 詰み回避チェック -->
- 複合ギミック（6-7・6-8）で UI 表示（トグル状態・踏破回数表示）が正しく再描画されるか。<!-- マルチ要素の UI 再確認 -->

# 第7章「拡張行動（複数マス移動カード＋シャッフルマス）」レギュレーション

<!-- 複数マス移動とシャッフルを組み合わせた中盤強化章。カードとタイル双方の新要素を統合する -->

## 概要
- 複数マス移動カードで高速移動ルートを開き、後半でシャッフルマスを加えてデッキ変動への対応力を養う。<!-- 章の狙いを共有 -->
- 前半（7-1〜7-4）は中央固定スポーンで新カードに集中し、後半（7-5〜7-8）は任意スポーンで運要素と初期位置を同時管理する。<!-- スポーン方針 -->
- 山札プリセットは `.extendedWithMultiStepMoves` を章全体で使用し、複数マス移動カードを常時供給する。<!-- 新カード供給を明記 -->
- ペナルティは `+3 / +2 / +1 / 0` に統一し、セカンダリ条件で難度調整。<!-- ペナルティ基準 -->

## 共通設定
<!-- 指定パラメータを明確化し、設計時の参照を容易にする -->
| 項目 | 値 |
|------|----|
| `boardSize` | 5（全ステージ共通で 5×5 を維持） |
| `spawnRule` | 7-1〜7-4: `.fixed(BoardGeometry.defaultSpawnPoint)` / 7-5〜7-8: `.chooseAnyAfterPreview`（任意スポーン化でシャッフル事故を抑制） |
| `deckPreset` | `.extendedWithMultiStepMoves`（複数マス移動カードを常備する拡張プリセット） |
| `penaltySettings` | `.init(deadlock: 3, manualRedraw: 2, manualDiscard: 1, revisit: 0)`（標準設定を継続） |

## ステージ一覧
<!-- ステージごとのカード構成・タイル構成・条件を具体化し、バランス調整の叩き台とする -->
| ステージ | 盤面 / スポーン | 山札プリセット | 特殊タイル / カード | セカンダリ条件 | スコア上限 | ペナルティ設定 | アンロック条件 |
|----------|-----------------|----------------|----------------------|----------------|------------|-----------------|----------------|
| 7-1 拡張移動導入 | 5×5 / 中央固定 | `extendedWithMultiStepMoves` | 複数マス移動カード（直線3 / 斜め3）常駐 | 38 手以内 | 440 以下 | +3 / +2 / +1 / 0 | 6-8 転送最終演習クリア |
| 7-2 拡張移動応用 | 5×5 / 中央固定 | `extendedWithMultiStepMoves` | 複数マス移動カード＋桂馬強化カード重み増し | ペナルティ合計 2 以下 | 435 以下 | +3 / +2 / +1 / 0 | 7-1 クリア |
| 7-3 障害回避演習 | 5×5 / 中央固定 | `extendedWithMultiStepMoves` | 障害物 {(2,2)}＋複数マス移動カード | 36 手以内 | 430 以下 | +3 / +2 / +1 / 0 | 7-2 クリア |
| 7-4 直線連携訓練 | 5×5 / 中央固定 | `extendedWithMultiStepMoves` | 二度踏み {(1,1):2,(3,3):2}＋直線 3 マスカード重視 | ペナルティ合計 1 以下 | 425 以下 | +3 / +2 / +1 / 0 | 7-3 クリア |
| 7-5 シャッフル導入 | 5×5 / 任意スポーン | `extendedWithMultiStepMoves` | シャッフル {(2,2)}（山札再配置） | 36 手以内 | 420 以下 | +3 / +2 / +1 / 0 | 7-4 クリア |
| 7-6 シャッフル応用 | 5×5 / 任意スポーン | `extendedWithMultiStepMoves` | シャッフル {(2,2)}＋障害物 {(1,3)} | ペナルティ合計 2 以下 | 415 以下 | +3 / +2 / +1 / 0 | 7-5 クリア |
| 7-7 複合行動課題 | 5×5 / 任意スポーン | `extendedWithMultiStepMoves` | シャッフル {(2,2)}＋トグル {(1,1),(3,3)}＋複数マス移動カード | 34 手以内 | 410 以下 | +3 / +2 / +1 / 0 | 7-6 クリア |
| 7-8 拡張行動総決算 | 5×5 / 任意スポーン | `extendedWithMultiStepMoves` | シャッフル {(0,0),(4,4)}＋二度踏み {(2,2):2}＋障害物 {(1,1)} | ペナルティ合計 2 以下＆32 手以内 | 405 以下 | +3 / +2 / +1 / 0 | 7-7 クリア |

## 実装デザイン仕様
<!-- 新カードとシャッフルタイルの表現仕様を先に固め、アセット制作の迷いを減らす -->
- **複数マス移動カードのビジュアル**: 縦横斜めに連続した 3 本矢印を白基調＋シアン残光で描き、カード背景は濃グレーでコントラストを確保。<!-- 視認性の確保 -->
- **複数マス移動カードのアニメーション**: 使用時に移動経路へ 0.3 秒残る光の軌跡を描画し、駒が最終マスへスムーズ移動する様子を 200ms で再現。<!-- マルチステップの動きを可視化 -->
- **シャッフルマスのビジュアル / アニメーション**: 円形矢印アイコンをグリッド中央に配置し、踏破時にカード束が回転する 0.25 秒アニメーションを表示。<!-- シャッフル動作を説明 -->
- **サウンド方針**: 本章でも新規 SE は追加せず、視覚効果のみで状態変化を伝達する。<!-- 指示遵守 -->

## QA チェック観点
<!-- QA チームが着目すべき動作確認ポイントを具体化 -->
- 複数マス移動カード使用時に各ステップの UI ハイライトが漏れなく更新されるか。<!-- マルチステップ UI の同期確認 -->
- シャッフルマス踏破後に手札・先読みが即時更新され、重複カードの整列が崩れないか。<!-- シャッフル挙動の安定性 -->
- 任意スポーンと複合ギミック（7-7・7-8）で致命的な初手詰みが発生しないかを 30 回試行で検証。<!-- 詰み回避 -->

# 第8章「空間支配（ワープカード＋スーパーワープカード）」レギュレーション

<!-- 章8はカードによる瞬間転移をテーマにした終盤章。既存ギミックと新カード効果を組み合わせて総合力を問う -->

## 概要
- ワープカード・スーパーワープカードで任意マス転移を可能にし、ギミック混在ステージで空間制御力を試す。<!-- 章コンセプト共有 -->
- 前半（8-1〜8-4）は中央固定スポーンでカード挙動に集中し、後半（8-5〜8-8）は任意スポーンで難度を一段引き上げる。<!-- スポーン政策 -->
- 山札プリセットは `.standardWithWarpCards` を使用し、既存カード＋ワープ系カードの混成で構成する。<!-- デッキ内容 -->
- ペナルティは `+3 / +2 / +1 / 0` を継続し、セカンダリ条件で締め付けを強化する。<!-- ペナルティ説明 -->

## 共通設定
<!-- 指定値を表形式で整理し、設計・実装間の齟齬を防ぐ -->
| 項目 | 値 |
|------|----|
| `boardSize` | 5（5×5 を維持し、カード効果の検証に集中） |
| `spawnRule` | 8-1〜8-4: `.fixed(BoardGeometry.defaultSpawnPoint)` / 8-5〜8-8: `.chooseAnyAfterPreview`（任意スポーンでカード自由度を活かす） |
| `deckPreset` | `.standardWithWarpCards`（ワープカード＆スーパーワープカードを含む想定プリセット） |
| `penaltySettings` | `.init(deadlock: 3, manualRedraw: 2, manualDiscard: 1, revisit: 0)`（章を通して一定） |

## ステージ一覧
<!-- カード効果と盤面ギミックの組み合わせを列挙し、最終調整時の確認を容易にする -->
| ステージ | 盤面 / スポーン | 山札プリセット | 特殊タイル / カード | セカンダリ条件 | スコア上限 | ペナルティ設定 | アンロック条件 |
|----------|-----------------|----------------|----------------------|----------------|------------|-----------------|----------------|
| 8-1 ワープカード訓練 | 5×5 / 中央固定 | `standardWithWarpCards` | ワープカード（任意の未踏マスへ転移）を重み高で供給 | 38 手以内 | 400 以下 | +3 / +2 / +1 / 0 | 7-8 拡張行動総決算クリア |
| 8-2 スーパーワープ試験 | 5×5 / 中央固定 | `standardWithWarpCards` | スーパーワープカード（任意マス＋踏破済マス再訪可） | ペナルティ合計 2 以下 | 395 以下 | +3 / +2 / +1 / 0 | 8-1 クリア |
| 8-3 障害物併用演習 | 5×5 / 中央固定 | `standardWithWarpCards` | 障害物 {(2,2)}＋ワープカード | 36 手以内 | 390 以下 | +3 / +2 / +1 / 0 | 8-2 クリア |
| 8-4 反転連動演習 | 5×5 / 中央固定 | `standardWithWarpCards` | トグル {(1,1),(3,3)}＋スーパーワープカード | 34 手以内 | 385 以下 | +3 / +2 / +1 / 0 | 8-3 クリア |
| 8-5 任意転移演習 | 5×5 / 任意スポーン | `standardWithWarpCards` | ワープカード＋二度踏み {(2,2):2} | ペナルティ合計 2 以下 | 380 以下 | +3 / +2 / +1 / 0 | 8-4 クリア |
| 8-6 デッキ混成実戦 | 5×5 / 任意スポーン | `standardWithWarpCards` | ワープカード＋スーパーワープカード混在＋ワープ {(0,4)↔(4,0)} タイル | 32 手以内 | 375 以下 | +3 / +2 / +1 / 0 | 8-5 クリア |
| 8-7 空間支配課題 | 5×5 / 任意スポーン | `standardWithWarpCards` | トグル {(2,2)}＋障害物 {(1,1)}＋ワープカード群 | ペナルティ合計 1 以下 | 370 以下 | +3 / +2 / +1 / 0 | 8-6 クリア |
| 8-8 空間支配最終試験 | 5×5 / 任意スポーン | `standardWithWarpCards` | スーパーワープカード必須＋トグル {(1,3)}＋二度踏み {(3,1):2}＋障害物 {(0,0)} | ペナルティ合計 1 以下＆30 手以内 | 365 以下 | +3 / +2 / +1 / 0 | 8-7 クリア |

## 実装デザイン仕様
<!-- 新カードの視覚演出のみを明記し、開発メモを簡潔に共有 -->
- **ワープカードのビジュアル**: カード面に円形ゲートと紫白グラデーションの軌跡を描き、既存カードとの差別化を図る。<!-- カードデザイン方針 -->
- **スーパーワープカードのビジュアル**: 中央に星型ゲートと多層リングを配置し、外周を淡い虹色で発光させて上位版であることを示す。<!-- 上位カードの視認性を強化 -->
- **カード使用アニメーション**: 発動時は対象マスへ 0.25 秒の光柱を描写し、スーパーワープは 0.35 秒の多層リング拡散を追加。<!-- 効果差を視覚化 -->
- **サウンド方針**: 新規 SE は導入せず、無音演出で統一する。視覚効果と操作感のバランスを優先。<!-- SE なしを明記 -->

## QA チェック観点
<!-- 終盤章での想定リスクを洗い出す -->
- ワープカード / スーパーワープカード使用時のターゲット選択 UI が正しく更新され、誤選択が発生しないか。<!-- ターゲット UI 検証 -->
- 任意スポーン導入後（8-5〜8-8）にワープ系カードが即詰みを誘発しないかを 30 回以上検証。<!-- 詰み回避 -->
- トグル・二度踏み・障害物との複合ステージ（8-6〜8-8）で踏破表示が正しく同期するか。<!-- 複合ギミック検証 -->

