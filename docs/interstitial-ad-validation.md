# インタースティシャル広告の再表示検証手順

以下は、表示失敗→再ロード→成功表示の一連の流れをデバッグビルド上で確認するための手順です。

1. Xcode でデバッグビルドを起動し、`AdsService` のログが Xcode コンソールに表示される状態を用意します。
2. 結果画面などから `AdsService.showInterstitial()` が呼ばれるタイミングで、あえてテストデバイスをオフラインにするか、`View Hierarchy` デバッガから提示中のインタースティシャルを閉じる前にアプリをバックグラウンドへ移動し、SDK に表示失敗を発生させます。
   - 失敗時には `インタースティシャル広告の表示に失敗` ログの直後に `インタースティシャル広告の再読み込みを 30.0 秒後にスケジュールしました` が出力され、`hasShownInCurrentPlay = false` へ戻っていることを `presentInterstitialIfNeededAfterLoad()` のトレースから確認できます。
3. 30 秒経過後に自動で `インタースティシャル広告の読み込みが完了しました` が出力され、続けて `読み込み完了直後にインタースティシャル広告を自動表示します` → `インタースティシャル広告の表示処理をトリガーしました` の順にログが流れることを確認します。
4. 今度はネットワークを復帰させるなど、実際に広告が表示できる状態に戻します。成功時には `インタースティシャル広告の表示が成功したためインターバル制御を更新しました` が出力され、ここでのみ 5 分インターバル (`lastInterstitialDate`) と 1 プレイ制限 (`hasShownInCurrentPlay`) が更新されます。
5. `adDidDismissFullScreenContent(_:)` のログに続いて `インタースティシャル広告を閉じたため次の読み込みを開始します` が表示されること、および 5 分以内に再度 `showInterstitial()` を呼び出すと `前回表示から 5 分未満のためインタースティシャル広告を表示しません` が出力されることを確認し、成功表示時だけインターバルが反映されることを検証します。

これらのログを追うことで、表示失敗後でも待機フラグが維持され、再読み込み後に自動表示が実行されることを確認できます。
