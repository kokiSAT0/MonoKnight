# リファクタリングタスクボード

<!-- この表はリファクタリング指針に基づく優先タスクを管理するためのもの -->
<!-- コメントは全て日本語で記載し、読みやすさを重視している -->

| 優先度 | 区分 | タスク内容 | 状態 | 備考 |
|:------:|:----|:-----------|:----:|:-----|

| 高     | UI | `GameView` の責務を ViewModel 層へ移譲し、描画とロジックの境界を明確化する | [x] | <!-- 1 ファイルに集中している状態管理を分離し、クラッシュリスクを減らす -->アニメーション制御とサービス呼び出しを再構成する |
| 高     | サービス | `AdsConsentCoordinator` と `AdsService` の統合テストシナリオを整備し、同意状態ごとの挙動を自動検証する | [x] | <!-- ATT/UMP 周りの回帰を防ぐ重要タスク -->ダミー環境とログ検証を組み合わせて QA を効率化する |
| 中     | ゲームコア | モード定義 (`GameMode`) のパラメータをドキュメント化し、Free モードとの整合性チェックを自動化する | [x] | <!-- 盤面サイズ追加時の破綻を防ぐ -->`docs/game-mode-parameters.md` に仕様を整理し、`FreeModeRegulationStoreTests` で自動検証を追加 |

| 高     | ゲームコア | `Game` パッケージの依存関係棚卸しと公開 API の命名・アクセス制御見直し | [x] | <!-- UI からの利用方法統一を狙う重要タスク -->`GameModuleInterfaces` を導入し、UI からの GameCore 生成経路を一本化 |
| 高     | ゲームコア | 盤面サイズや座標計算の定数を抽象化し、ユーティリティとして切り出す | [x] | <!-- 将来の盤面拡張を想定した設計 -->`BoardGeometry` ユーティリティで共通化しテストを追加 |
| 高     | UI | SwiftUI と SpriteKit の橋渡し層に ViewModel を導入して状態管理を整理 | [x] | <!-- 状態の単一責務化で不具合を防ぐ -->描画更新とゲーム状態を分離する |
| 高     | サービス | StoreKit・Game Center・AdMob の共通プロトコル整備とモック実装作成 | [x] | <!-- 非同期処理の標準化で信頼性を高める -->依存注入を共通化し、UI からプロトコル経由でサービスを操作できる状態を確認 |
| 中     | サービス | ATT・UMP の状態遷移をドキュメント化し、コードへ反映 | [x] | <!-- 審査対応を想定した整合性確保 -->`docs/att-ump-consent-flow.md` に状態遷移表を追記し、`AdsConsentCoordinator` で ATT を考慮するよう更新 |
| 中     | ドキュメント | `docs/recommended-task-list.md` を更新して負債棚卸し結果を反映 | [x] | <!-- タスクの可視化を最新に保つ -->同意フロー整備完了の反映と次アクションの棚卸し |
| 中     | プロセス | リファクタリング後に `swift test` 実行を必須とするチェックリストを整備 | [x] | <!-- 品質基準を自動化 -->`docs/refactoring-quality-checklist.md` を追加し、PR 単位での確認項目を明文化 |
| 低     | 運用 | リファクタリング効果をクラッシュログ・フィードバックで定期検証 | [x] | <!-- スプリント末の見直しタスク -->`CrashFeedbackCollector` を導入し、自動ログ出力とレビュー履歴を保存 |
